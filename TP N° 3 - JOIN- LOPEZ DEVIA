--TP N°3 LOPEZ DEVIA MELANIE


--1 Nick de usuario asociado a cada grupo. 
SELECT usuario.nick, grupo.descripcion 
FROM usuario_grupo 
	JOIN usuario 
		ON Usuario.ID = usuario_grupo.id_usuario 
	JOIN grupo 
		ON Grupo.ID = usuario_grupo.id_grupo;

--2 Descripción de grupos que tengan usuarios conectados el día de hoy. 
SELECT grupo.descripcion 
FROM grupo
	JOIN usuario 
		ON usuario.ultima_conexion = current_date;

--3  La cantidad de grupos a los que pertenece un usuario con un telefono dado. 

SELECT COUNT(id_usuario)
FROM usuario_grupo
	JOIN usuario 
		ON usuario.tel = 'telefono' --telefono referencia al valor a buscar
		WHERE usuario_grupo.id_usuario = usuario.id;
		

--4 Listado de los mensajes con sus estados.
SELECT mensaje.mensaje, estado.descripcion
FROM mensaje
	JOIN estado 
		ON mensaje.id_estado = estado.id;

--5 Conversación entre 2 usuarios. 
SELECT mensaje.mensaje, usuario.nick
FROM mensaje
	JOIN usuario 
		ON usuario.id = 'id' -- referencia si se buscaria por el id de los usuarios
		WHERE mensaje.id_usr_from = usuario.id or mensaje.id_usr_to = usuario.id;
		

--6 Igual al punto 5, pero mostrando también los estados. 
SELECT mensaje.mensaje, usuario.nick, estado.descripcion
FROM mensaje
	JOIN usuario 
		ON usuario.id = 'id' --idem anterior
	JOIN estado 
		ON estado.id = mensaje.id
		WHERE mensaje.id_usr_from = usuario.id or mensaje.id_usr_to = usuario.id;
	

--7  Listar los mensajes ignorados por los usuarios.
SELECT mensaje.mensaje
FROM mensaje
	JOIN estado 
		ON estado.descripcion = 'Recibido'
	JOIN usuario 
		ON mensaje.id_usr_from = usuario.id
		WHERE mensaje.id_estado = estado.id AND mensaje.fecha_envio < usuario.ultima_conexion;
